<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<title>白银市铁塔公司</title>
<link rel="stylesheet" href="resources/css/common.css" type="text/css" />
<link rel="stylesheet" href="resources/css/navigation.css"
	media="screen" />
<link rel="stylesheet" type="text/css" href="resources/css/scroll-x.css" />
<script src="resources/js/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="resources/js/navigation.js"></script>
<script type="text/javascript"
	src="http://api.map.baidu.com/api?v=2.0&ak=hA6MBvmAuh6ALz5nUAuicg7e"></script>
<script type="text/javascript"
	src="http://api.map.baidu.com/library/AreaRestriction/1.2/src/AreaRestriction_min.js"></script>
<script type="text/javascript"
	src="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
<link rel="stylesheet"
	href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
<style type="text/css">
#allmap {
	width: 780px;
	height: 500px;
	overflow: hidden;
	margin: 0;
	font-family: "微软雅黑";
}
</style>
</head>
<body>
	<div id="container">
		<div id="navigate">
			<div class="n-0"></div>
			<div class="n-1"></div>
			<div class="n-3"></div>
			<div class="n-2">
				<div class="n-main">
					<div class="n-logo">
						<img src="resources/images/logo.png" />
					</div>
					<div id="nav-main">
						<!-- 导航_START -->
						<div id="nav">
							<div id="navigation" class="navigation clearfix">
								<ul class="clearfix">
									<li class="index-menu-item"><a href="#123">主页</a></li>
									<li><span></span></li>
									<li><a href="#123">栏目一</a>
										<ul>
											<li><a href="#123">条目一</a></li>
											<li><a href="#123">条目一</a></li>
										</ul></li>
									<li><span></span></li>
									<li><a href="#123">栏目二</a></li>
									<li><span></span></li>
									<li><a href="#123">栏目一</a>
										<ul>
											<li><a href="#123">条目一</a></li>
										</ul></li>
									<li><span></span></li>
									<li><a href="#123">栏目二</a></li>
									<li><span></span></li>
									<li><a href="#123">栏目一</a>
										<ul>
											<li><a href="#123">条目一</a></li>
										</ul></li>
								</ul>
							</div>
						</div>
						<!-- 导航_END -->
					</div>
				</div>
			</div>
			<div class="n-4"></div>
		</div>
		<!-- 头部 -->
		<div id="header"></div>
		<!-- 正文 -->
		<div id="content">
			<!-- 正文左侧 -->
			<div class="content-left">
				<div id="allmap"></div>


			</div>
			<!-- 正文左侧结束 -->
			<!-- 正文右侧-START -->
			<div class="content-right">
				<div class="company">
					<div class="c-name">白银市铁塔公司</div>
					<div class="c-welcome">欢迎访问白银市铁塔公司</div>
				</div>
				<div class="callme">
					<a href="#123"><div class="cm-bj1 cm-img">留&nbsp;言&nbsp;版</div></a>
					<a href="#123"><div class="cm-bj1 cm-img">意见建议</div></a> <a
						href="#123"><div class="cm-bj2 cm-img">信号问题反馈</div></a>
					<div class="cm-d">
						<div class="cm-d1">联系我们</div>
						<div class="cm-d2">Tel:000-0000-0000</div>
						<div class="cm-d2">Add:这里放置公司地址文字这里放置公司地址文字</div>
					</div>
				</div>
				<div class="sep"></div>
				<!-- 合作伙伴-START -->
				<div class="leader">
					<div class="title">
						<div class="title-red">主要客户与合作伙伴</div>
					</div>
					<div class="sep-10"></div>
					<div class="partner">
						<div class="partnet-1">
							<a href="#123"><img src="resources/images/partner2.png" /></a> <a
								href="#123"><img src="resources/images/partner3.png" /></a>
						</div>
						<div class="partnet-1">
							<a href="#123"><img src="resources/images/partner4.png" /></a> <a
								href="#123"><img src="resources/images/partner1.png" /></a>
						</div>
						<div class="partnet-1">
							<a href="#123"><img src="resources/images/partner2.png" /></a> <a
								href="#123"><img src="resources/images/partner3.png" /></a>
						</div>
						<div class="partnet-1">
							<a href="#123"><img src="resources/images/partner4.png" /></a> <a
								href="#123"><img src="resources/images/partner1.png" /></a>
						</div>
					</div>
				</div>
				<!-- 合作伙伴-END -->
				<div class="sep"></div>
				<!-- 友情链接-START -->
				<div class="friend">
					<div class="title">
						<div class="title-red">友情链接</div>
					</div>
					<div class="friends">
						<span class="friends-detail"> <select>
								<option value="noOpen">友情链接级别分类</option>
								<option value="http://www.baidu.com">百度</option>
								<option value="http://mail.189.cn">189邮箱</option>
								<option value="http://mail.163.com">163邮箱</option>
						</select>
						</span> <span class="friends-detail"> <select>
								<option value="noOpen">友情链接级别分类</option>
								<option value="http://www.baidu.com">百度</option>
								<option value="http://mail.189.cn">189邮箱</option>
								<option value="http://mail.163.com">163邮箱</option>
						</select>
						</span> <span class="friends-detail"> <select>
								<option value="noOpen">友情链接级别分类</option>
								<option value="http://www.baidu.com">百度</option>
								<option value="http://mail.189.cn">189邮箱</option>
								<option value="http://mail.163.com">163邮箱</option>
						</select>
						</span> <span class="friends-detail"> <select>
								<option value="noOpen">友情链接级别分类</option>
								<option value="http://www.baidu.com">百度</option>
								<option value="http://mail.189.cn">189邮箱</option>
								<option value="http://mail.163.com">163邮箱</option>
						</select>
						</span>
					</div>
				</div>
				<!-- 友情链接-END -->
			</div>
			<!-- 正文右侧-End -->
		</div>
		<!-- 正文_END -->
		<!-- 页脚_START -->
		<div class="sep"></div>
		<div class="sep"></div>
		<div class="footer">
			<div class="sep"></div>
			<div class="f-s b-r">
				<div class="f-s-t">关于我们</div>
				<div class="f-s-d">
					<a href="#123">了解我们</a>
				</div>
				<div class="f-s-d">
					<a href="#123">加入我们</a>
				</div>
				<div class="f-s-d">
					<a href="#123">联系我们</a>
				</div>
			</div>
			<div class="f-s b-r">
				<div class="f-s-t">关注我们</div>
				<div class="f-s-d">
					<a href="#123">新浪微博</a>
				</div>
				<div class="f-s-d">
					<a href="#123">QQ空间</a>
				</div>
				<div class="f-s-d">
					<a href="#123">官方微信</a>
				</div>
			</div>
			<div class="f-s b-r">
				<div class="f-s-t">服务与支持</div>
				<div class="f-s-d">
					<a href="#123">知识库</a>
				</div>
				<div class="f-s-d">
					<a href="#123">问题反馈</a>
				</div>
			</div>
			<div class="f-b">
				<div class="f-b-1">
					<img src="resources/images/ewm.jpg" width="78" height="78" />
				</div>
				<div class="f-b-2">
					<div>扫描二维码</div>
					<div>手机登录铁塔公司</div>
				</div>
			</div>
		</div>
		<div class="sep"></div>
		<div class="sep"></div>
		<!-- 页脚_END -->
	</div>

	<script type="text/javascript">
		// 百度地图API功能
		// 创建Map实例
		var map = new BMap.Map("allmap");
		var gc = new BMap.Geocoder();
		// 初始化地图,设置中心点坐标和地图级别
		map.centerAndZoom(new BMap.Point(104.177, 36.541), 13);
		//添加地图类型控件
		map.addControl(new BMap.MapTypeControl());
		map.addControl(new BMap.NavigationControl());

		// 设置地图显示的城市 此项是必须设置的
		map.setCurrentCity("白银");
		//开启鼠标滚轮缩放
		map.enableScrollWheelZoom(true);

		//控制视野范围
		var b = new BMap.Bounds(new BMap.Point(104.135, 36.507),
				new BMap.Point(104.219, 36.575));
		try {
			BMapLib.AreaRestriction.setBounds(map, b);
		} catch (e) {
			alert(e);
		}
		// 图层加载完成事件
		map.addEventListener("tilesloaded", function() {
			init_markers();
		});

		//标注地图要素
		//单击事件:添加标注
		map.addEventListener("click", map_click);
		// 要素数组
		var arrayMarkers = new Array();
		var formWindow = null;
		var currPoint = new Object();

		var opt = {
			title : "信号问题反馈", //标题
			width : 290, //宽度
			height : 180, //高度
			panel : "panel", //检索结果面板
			enableAutoPan : true, //自动平移
			enableMessage : true, //设置允许信息窗发送短息
			searchTypes : []
		}

		//初始化标识
		function init_markers() {
			drawMarker(104.177, 36.541, "1", "dfdfdfd");
		}

		function map_click(e) {
			var point = new BMap.Point(e.point.lng, e.point.lat);
			//获取地址信息  
			gc.getLocation(point, function(rs) {
				addMarker(point, rs);
			});
		}

		// 增加标注
		function addMarker(point, rs) {
			var marker = new BMap.Marker(point);
			marker.enableDragging(); //marker可拖拽

			// marker 不支持拖动事件
			marker.addEventListener("dragend", function(e) {
				/* //获取地址信息  
				gc.getLocation(e.point, function(rs){  
				    showLocationInfo(e.point, rs);  
				});   */
			});
			map.addOverlay(marker);

			arrayMarkers.push(marker);
			currPoint.lng = point.lng;
			currPoint.lat = point.lat;

			var addComp = rs.addressComponents;
			var address = "当前位置：" + addComp.province + ", " + addComp.city
					+ ", " + addComp.district + ", " + addComp.street + ", "
					+ addComp.streetNumber + "";

			var formHtml = "<div style='width: 280px;'>"
					+ "<form id='markform' action='#' method=\"post\">"
					+ "<label>经度:</label><input type='text' id='lng' name='lng' value='"+point.lng+"'><br>"
					+ "<label>纬度:</label><input type='text' id='lat' name='lat' value='"+point.lat+"'><br>"
					+ "<label>来源:</label>"
					+ "<input type='radio' name=''> 电信 "
					+ "<input type='radio' name=''> 移动 "
					+ "<input type='radio' name=''> 联通 "
					+ "<input type='radio' name=''> 个人 <br>"
					+ "<label>联系方式:</label><input type='text' name=''><br>"
					+ "<label>反馈内容:</label><textarea name=''>"
					+ address
					+ " </textarea><br><br>"
					+ "<input type='button' value='提交' onclick='submitMarker();'>&nbsp;&nbsp;&nbsp;"
					+ "<input type='button' value='取消' onclick='delMarker();'>"
					+ "</form>" + "</div>";
			// 创建信息窗口对象
			formWindow = new BMapLib.SearchInfoWindow(map, formHtml, opt);
			// 开启信息窗口
			formWindow.open(new BMap.Point(point.lng, point.lat));
		}

		
		//删除标注
		function delMarker() {
			var marker = arrayMarkers.pop();
			map.removeOverlay(marker);
			formWindow.close();
		}

		//绘制标注
		function drawMarker(lng, lat, type, content) {
			var point = new BMap.Point(lng, lat);
			//自定义标注图标
			var icon = new BMap.Icon('pin.png', new BMap.Size(20, 32), {
				anchor : new BMap.Size(10, 30)
			});
			//根据不同运营商，采用不同的标注
			if (type == "1") {
				icon = new BMap.Icon('1.png', new BMap.Size(20, 32), {
					anchor : new BMap.Size(10, 30)
				});
			} else if (type == "2") {
				icon = new BMap.Icon('2.png', new BMap.Size(20, 32), {
					anchor : new BMap.Size(10, 30)
				});
			} else if (type == "3") {
				icon = new BMap.Icon('3.png', new BMap.Size(20, 32), {
					anchor : new BMap.Size(10, 30)
				});
			}
			var marker = new BMap.Marker(point, icon);
			marker.addEventListener("mouseover", function(e) {
				openInfoWin(content, e);
			});
			map.addOverlay(marker);
		}

		function openInfoWin(content, e) {
			var p = e.target;
			var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
			//获取地址信息  
			gc.getLocation(point, function(rs) {
				var addComp = rs.addressComponents;
				var address = "当前位置:" + addComp.province + ", " + addComp.city
				+ ", " + addComp.district + ", " + addComp.street + ", "
				+ addComp.streetNumber + "";
				content = address + content;
				var infoWindow = new BMap.InfoWindow(content, opt); // 创建信息窗口对象 
				map.openInfoWindow(infoWindow, point); //开启信息窗口
			});
			
		}

		//验证表单
		function validateForm() {
			var lng = $("#lng").val();
			if (lng == "") {
				return false;
			}
			return true;
		}

		//提交表单
		function submitMarker() {
			if (validateForm()) {
				$.ajax({
					type : "POST",
					url : "#.json",
					data : $("#markform").serialize(),
					success : function(data) {
						var resultContent = "问题反馈成功。";
						formWindow.close();
						formWindow = new BMapLib.SearchInfoWindow(map,
								resultContent, opt);
						formWindow.open(new BMap.Point(currPoint.lng,
								currPoint.lat));
					}
				});
			}
		}

		//查询标注点
		function queryMarkers() {
			$.ajax({
				type : "GET",
				url : "#.json",
				dataType : "json",
				success : function(data) {
					$.each(data, function(index, item) {
						drawMarker(item.lng, item.lat, item.type, item.desc);
					});
				}
			});
		}
	</script>
</body>
</html>
